# –°–∏—Å—Ç–µ–º–∞ –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üìä –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –º–µ—Ç—Ä–∏–∫ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã Meet-Commit Bot, –æ—Ç—Å–ª–µ–∂–∏–≤–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –æ—à–∏–±–∫–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã.

## üéØ –ó–∞—á–µ–º –Ω—É–∂–Ω—ã –º–µ—Ç—Ä–∏–∫–∏

### 1. üîç –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –ø–∞–π–ø–ª–∞–π–Ω–∞
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–ª –∫–∞–∫ "—á–µ—Ä–Ω—ã–π —è—â–∏–∫" - –∑–∞–≥—Ä—É–∑–∏–ª —Ñ–∞–π–ª ‚Üí –ø–æ–ª—É—á–∏–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- **–†–µ—à–µ–Ω–∏–µ:** –í–∏–¥–∏–º, –≥–¥–µ —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ —Ç—Ä–∞—Ç–∏—Ç—Å—è (ingest, LLM, Notion, tagging)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø–æ–Ω–∏–º–∞–µ–º "–ü–æ—á–µ–º—É —Å–µ–≥–æ–¥–Ω—è –≤—Å—ë —Ç–æ—Ä–º–æ–∑–∏—Ç?" –∏–ª–∏ "–ù–∞ —á—Ç–æ —É—Ö–æ–¥–∏—Ç 80% –≤—Ä–µ–º–µ–Ω–∏"

### 2. üö® –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º
- **Notion API –ø–∞–¥–∞–µ—Ç** ‚Üí –≤ `/metrics` —Ä–∞—Å—Ç—ë—Ç —Å—á—ë—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ `notion.create_meeting`
- **OpenAI –æ—Ç–≤–µ—á–∞–µ—Ç –¥–æ–ª—å—à–µ** ‚Üí –≤–∏–¥–Ω–æ —Ä–æ—Å—Ç p95 —É `llm.summarize`
- **Tagger —Å—ã–ø–µ—Ç—Å—è** ‚Üí –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤–∏–¥–∏–º spike –≤ error-–ª–æ–≥–∞—Ö

### 3. üìà –ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
- **SLA –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** "95% —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∑–∞ ‚â§2 –º–∏–Ω—É—Ç—ã"
- **–ö–∞—á–µ—Å—Ç–≤–æ –¥–µ–¥—É–ø–∞:** –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ–±—ä—ë–º–∞ —Ç–µ–≥–æ–≤ —á–µ—Ä–µ–∑ counters
- **Cache hit rate:** —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### 4. üéõÔ∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- –î–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ Prometheus/Grafana/Notion-–¥–∞—à–±–æ—Ä–¥
- –£—Ä–æ–≤–µ–Ω—å –∑—Ä–µ–ª–æ—Å—Ç–∏ "–Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞", –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–∫—Ä–∏–ø—Ç–∞

### 5. üöÄ –ë—É–¥—É—â–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- **–ê–≤—Ç–æ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:** –µ—Å–ª–∏ LLM —á–∞—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç—ã–µ –∫–æ–º–º–∏—Ç—ã ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry —Å –∑–∞–ø–∞—Å–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º
- **Load balancing:** –µ—Å–ª–∏ –ø–∏–∫–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –ø–æ Notion –≤ 18:00 ‚Üí –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –±–∞—Ç—á–∏–Ω–≥–∞

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã:
```python
app/core/metrics.py          # –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å –º–µ—Ç—Ä–∏–∫
‚îú‚îÄ‚îÄ –°—á–µ—Ç—á–∏–∫–∏ (counters)      # inc("operation.success")
‚îú‚îÄ‚îÄ –û—à–∏–±–∫–∏ (errors)          # err("operation", "details")  
‚îú‚îÄ‚îÄ –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (latency)    # observe_latency("operation", ms)
‚îú‚îÄ‚îÄ LLM —Ç–æ–∫–µ–Ω—ã (llm_tokens)  # track_llm_tokens("llm.op", prompt, completion, total)
‚îî‚îÄ‚îÄ –¢–∞–π–º–µ—Ä—ã (timers)         # @wrap_timer, timer(), async_timer()
```

### Thread-safe —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:
- **RLock** –¥–ª—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **defaultdict** –¥–ª—è –∞–≤—Ç–æ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- **deque** –¥–ª—è —Å–∫–æ–ª—å–∑—è—â–∏—Ö –æ–∫–æ–Ω (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 –∏–∑–º–µ—Ä–µ–Ω–∏–π)
- **NamedTuple** –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–Ω–∏–º–∫–æ–≤

## üìã –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### ü§ñ LLM –æ–ø–µ—Ä–∞—Ü–∏–∏
```python
MetricNames.LLM_SUMMARIZE          # llm.summarize
MetricNames.LLM_EXTRACT_COMMITS    # llm.extract_commits
```
**–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º:**
- –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (avg, p50, p95, p99)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ (prompt, completion, total)
- –£—Å–ø–µ—à–Ω—ã–µ/–Ω–µ—É—Å–ø–µ—à–Ω—ã–µ –≤—ã–∑–æ–≤—ã
- Retry –ø–æ–ø—ã—Ç–∫–∏

### üóÑÔ∏è Notion API
```python
MetricNames.NOTION_CREATE_MEETING      # notion.create_meeting
MetricNames.NOTION_UPSERT_COMMITS      # notion.upsert_commits  
MetricNames.NOTION_QUERY_COMMITS       # notion.query_commits
MetricNames.NOTION_UPDATE_COMMIT_STATUS # notion.update_commit_status
```
**–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º:**
- –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å API –≤—ã–∑–æ–≤–æ–≤
- Rate limit –æ—à–∏–±–∫–∏
- –ë–∞—Ç—á–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞, –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏)

### üìÅ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤
```python
MetricNames.INGEST_EXTRACT     # ingest.extract
MetricNames.INGEST_NORMALIZE   # ingest.normalize
```
**–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º:**
- –í—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ (.pdf, .docx, .vtt)
- –†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤ vs –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

### üè∑Ô∏è –¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
MetricNames.TAGGING_TAG_TEXT   # tagging.tag_text
MetricNames.TAGGING_V1_SCORED  # tagging.v1_scored
```
**–û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º:**
- Cache hit/miss rate
- –í—Ä–µ–º—è —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ç–µ–≥–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π tags.py

### üîÑ –ü–∞–π–ø–ª–∞–π–Ω —ç—Ç–∞–ø—ã
```python
MetricNames.PIPELINE_TOTAL        # pipeline.total
MetricNames.PIPELINE_LLM_PHASE    # pipeline.llm_phase
MetricNames.PIPELINE_NOTION_PHASE # pipeline.notion_phase
```

## üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
```python
from app.core.metrics import inc, err, observe_latency, timer

# –°—á–µ—Ç—á–∏–∫–∏
inc("operation.success")
inc("operation.calls", 5)

# –û—à–∏–±–∫–∏  
err("operation.failed", "Connection timeout")

# –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
observe_latency("operation", 123.45)  # ms

# –¢–∞–π–º–µ—Ä—ã
with timer("operation"):
    # –í–∞—à –∫–æ–¥
    pass
```

### –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã:
```python
from app.core.metrics import wrap_timer, MetricNames

@wrap_timer(MetricNames.LLM_SUMMARIZE)
def summarize_text(text: str) -> str:
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–º–µ—Ä—è–µ—Ç—Å—è –≤—Ä–µ–º—è + —Å—á–µ—Ç—á–∏–∫–∏ —É—Å–ø–µ—Ö–∞/–æ—à–∏–±–æ–∫
    return llm_call(text)

@wrap_timer("custom.operation")
async def async_operation() -> None:
    # –†–∞–±–æ—Ç–∞–µ—Ç –∏ —Å async —Ñ—É–Ω–∫—Ü–∏—è–º–∏
    await some_async_call()
```

### LLM —Ç–æ–∫–µ–Ω—ã:
```python
from app.core.metrics import track_llm_tokens

# –ü–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ OpenAI API
if response.usage:
    track_llm_tokens(
        "llm.summarize",
        response.usage.prompt_tokens,
        response.usage.completion_tokens, 
        response.usage.total_tokens
    )
```

### –°–Ω–∏–º–∫–∏ –º–µ—Ç—Ä–∏–∫:
```python
from app.core.metrics import snapshot

snap = snapshot()
print(f"LLM calls: {snap.counters.get('llm.summarize.success', 0)}")
print(f"Avg latency: {snap.latency['llm.summarize']['avg']:.1f}ms")
print(f"Total tokens: {snap.llm_tokens['llm.summarize']['total_tokens']}")
```

## üìä –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### `/metrics` - –û–±—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```
üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

ü§ñ LLM –æ–ø–µ—Ä–∞—Ü–∏–∏:
üìù llm.summarize: n=15 avg=1247.3ms p95=2103.1ms p99=2890.0ms
üìã llm.extract_commits: n=12 avg=1891.2ms p95=3205.7ms p99=3456.2ms

üí∞ LLM —Ç–æ–∫–µ–Ω—ã:
üìù llm.summarize: 15 –≤—ã–∑–æ–≤–æ–≤, 45,230 —Ç–æ–∫–µ–Ω–æ–≤ (prompt: 32,100, completion: 13,130)
üìã llm.extract_commits: 12 –≤—ã–∑–æ–≤–æ–≤, 67,890 —Ç–æ–∫–µ–Ω–æ–≤ (prompt: 48,200, completion: 19,690)

üìÅ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤:
üìÑ ingest.extract: n=8 avg=234.1ms p95=456.7ms p99=567.8ms

üóÑÔ∏è Notion API:
üìÖ notion.create_meeting: n=8 avg=567.2ms p95=892.3ms p99=1203.4ms
üìù notion.upsert_commits: n=8 avg=1234.5ms p95=2103.1ms p99=2567.8ms
üîç notion.query_commits: n=45 avg=234.1ms p95=456.7ms p99=567.8ms
‚úÖ notion.update_commit_status: n=23 avg=189.3ms p95=324.5ms p99=456.7ms

üè∑Ô∏è –¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
üéØ tagging.tag_text: n=20 avg=123.4ms p95=234.5ms p99=345.6ms

‚úÖ –û—à–∏–±–æ–∫ –Ω–µ—Ç

üéØ –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
   ‚Ä¢ llm.summarize: 15
   ‚Ä¢ notion.create_meeting: 8
   ‚Ä¢ tagging.tag_text: 20
```

### `/tags_stats` - –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
–°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∫–æ–º–∞–Ω–¥–∞, –¥–æ–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π —Å –Ω–æ–≤—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏.

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∫–æ–¥

### LLM –º–æ–¥—É–ª–∏
**–§–∞–π–ª—ã:** `app/core/llm_summarize.py`, `app/core/llm_extract_commits.py`

```python
# –î–æ:
def extract_commits(...):
    client = create_client()
    response = client.chat.completions.create(...)
    return parse_response(response)

# –ü–æ—Å–ª–µ:
@wrap_timer(MetricNames.LLM_EXTRACT_COMMITS)
def extract_commits(...):
    client = create_client()
    response = client.chat.completions.create(...)
    
    # –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º —Ç–æ–∫–µ–Ω—ã
    if response.usage:
        track_llm_tokens(
            MetricNames.LLM_EXTRACT_COMMITS,
            response.usage.prompt_tokens,
            response.usage.completion_tokens,
            response.usage.total_tokens
        )
    
    return parse_response(response)
```

### Notion API
**–§–∞–π–ª—ã:** `app/gateways/notion_*.py`

```python
# –î–æ:
def upsert_meeting(payload):
    client = create_client()
    return client.pages.create(...)

# –ü–æ—Å–ª–µ:  
def upsert_meeting(payload):
    with timer(MetricNames.NOTION_CREATE_MEETING):
        client = create_client()
        return client.pages.create(...)
```

### –°–∏—Å—Ç–µ–º–∞ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
**–§–∞–π–ª:** `app/core/tags.py`

```python
# –î–æ:
def tag_text(text):
    # –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ _stats
    return _tag_cached(text)

# –ü–æ—Å–ª–µ:
def tag_text(text):
    with timer(MetricNames.TAGGING_TAG_TEXT):
        # –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ _stats
        result = _tag_cached(text)
        # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ–±—â–∏–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
        integrate_with_tags_stats(_stats)
        return result
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤
**–§–∞–π–ª:** `app/core/normalize.py`

```python
# –î–æ:
def run(raw_bytes, text, filename):
    return extract_and_normalize(...)

# –ü–æ—Å–ª–µ:
@wrap_timer(MetricNames.INGEST_EXTRACT)
def run(raw_bytes, text, filename):
    return extract_and_normalize(...)
```

## üìà –¢–∏–ø—ã –º–µ—Ç—Ä–∏–∫

### 1. –°—á–µ—Ç—á–∏–∫–∏ (Counters)
```python
inc("operation.success")      # –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
inc("operation.error")        # –û—à–∏–±–∫–∏
inc("operation.calls", 5)     # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤
```

### 2. –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (Latency)
```python
observe_latency("operation", 123.45)  # –í—Ä–µ–º—è –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è:
# - min, max, avg
# - p50, p95, p99 (–ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª–∏)
# - count (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–º–µ—Ä–µ–Ω–∏–π)
```

### 3. –û—à–∏–±–∫–∏ (Errors)
```python
err("operation", "Connection refused")

# –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è:
# - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
# - –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞ (–ø–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤)
# - –ü—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫ (error_rate)
```

### 4. LLM —Ç–æ–∫–µ–Ω—ã (Tokens)
```python
track_llm_tokens("llm.summarize", 1000, 300, 1300)

# –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è:
# - prompt_tokens (–≤—Ö–æ–¥–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã)
# - completion_tokens (–æ—Ç–≤–µ—Ç–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã)  
# - total_tokens (–æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)
# - calls (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–∑–æ–≤–æ–≤)
```

### 5. –ë–∞—Ç—á–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
```python
track_batch_operation("commits_process", batch_size=5, duration_ms=250.0)

# –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è:
# - batch.operation.items (–æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤)
# - batch.operation.calls (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞—Ç—á–µ–π)
# - –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–∞—Ç—á–∞
```

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –º–µ—Ç—Ä–∏–∫

### –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫:
1. **Timer context managers** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
2. **Decorators** - –ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
3. **Manual tracking** - —Ä—É—á–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
4. **Integration hooks** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### –•—Ä–∞–Ω–µ–Ω–∏–µ:
- **In-memory** - –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø, thread-safe
- **Structured data** - NamedTuple —Å–Ω–∏–º–∫–∏ –¥–ª—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **Rolling windows** - –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 –∏–∑–º–µ—Ä–µ–Ω–∏–π –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π

### –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:
- **`/metrics`** - –æ–±—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **`/tags_stats`** - –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (–∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞)
- **Snapshot API** - –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –º–µ—Ç—Ä–∏–∫–∞–º

## üß™ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –º–µ–¥–ª–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏:
```bash
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "–ë–æ—Ç —Å—Ç–∞–ª –º–µ–¥–ª–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å"
–ê–¥–º–∏–Ω: /metrics

–†–µ–∑—É–ª—å—Ç–∞—Ç:
ü§ñ LLM –æ–ø–µ—Ä–∞—Ü–∏–∏:
üìù llm.summarize: n=5 avg=3456.7ms p95=5234.1ms ‚Üê –ü–†–û–ë–õ–ï–ú–ê!
üìã llm.extract_commits: n=5 avg=1234.5ms p95=1890.2ms

# –í—ã–≤–æ–¥: –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏, –≤–æ–∑–º–æ–∂–Ω–æ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ OpenAI
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏:
```bash
# –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
–ê–¥–º–∏–Ω: /metrics

–†–µ–∑—É–ª—å—Ç–∞—Ç:
‚úÖ –û—à–∏–±–æ–∫ –Ω–µ—Ç
üéØ –£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
   ‚Ä¢ llm.summarize: 142
   ‚Ä¢ notion.create_meeting: 38
   ‚Ä¢ tagging.tag_text: 180

# –í—ã–≤–æ–¥: —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
```

### –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤:
```bash
–ê–¥–º–∏–Ω: /metrics

–†–µ–∑—É–ª—å—Ç–∞—Ç:
üí∞ LLM —Ç–æ–∫–µ–Ω—ã:
üìù llm.summarize: 50 –≤—ã–∑–æ–≤–æ–≤, 125,430 —Ç–æ–∫–µ–Ω–æ–≤
üìã llm.extract_commits: 45 –≤—ã–∑–æ–≤–æ–≤, 234,560 —Ç–æ–∫–µ–Ω–æ–≤

# –í—ã–≤–æ–¥: extract_commits –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç –±–æ–ª—å—à–µ —Ç–æ–∫–µ–Ω–æ–≤, –º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç
```

## üîß API Reference

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
```python
# –°—á–µ—Ç—á–∏–∫–∏
inc(name: str, by: int = 1) -> None

# –û—à–∏–±–∫–∏
err(name: str, detail: str | None = None) -> None

# –õ–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
observe_latency(name: str, ms: float) -> None

# LLM —Ç–æ–∫–µ–Ω—ã
track_llm_tokens(name: str, prompt_tokens: int, completion_tokens: int, total_tokens: int) -> None

# –¢–∞–π–º–µ—Ä—ã
@contextmanager
def timer(name: str): ...

@asynccontextmanager  
async def async_timer(name: str): ...

def wrap_timer(name: str) -> Callable: ...

# –°–Ω–∏–º–∫–∏
def snapshot() -> MetricSnapshot: ...

# –£—Ç–∏–ª–∏—Ç—ã
def get_error_rate(name: str) -> float: ...
def get_recent_latency(name: str, window_size: int = 10) -> list[float]: ...
def reset_metrics() -> None: ...  # –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
```

### MetricSnapshot —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
```python
@dataclass
class MetricSnapshot:
    counters: dict[str, int]           # –°—á–µ—Ç—á–∏–∫–∏
    errors: dict[str, int]             # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
    last_errors: dict[str, str]        # –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏
    latency: dict[str, dict[str, float]]  # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
    llm_tokens: dict[str, dict[str, int]] # LLM —Ç–æ–∫–µ–Ω—ã
    timestamp: float                   # –í—Ä–µ–º—è —Å–Ω–∏–º–∫–∞
```

## üéØ –¢–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 1. LLM –≤—ã–∑–æ–≤—ã:
- ‚úÖ `app/core/llm_summarize.py::run()` 
- ‚úÖ `app/core/llm_extract_commits.py::extract_commits()`

### 2. Notion API:
- ‚úÖ `app/gateways/notion_gateway.py::upsert_meeting()`
- ‚úÖ `app/gateways/notion_commits.py::upsert_commits()`
- ‚úÖ `app/gateways/notion_commits.py::_query_commits()`
- ‚úÖ `app/gateways/notion_commits.py::update_commit_status()`

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤:
- ‚úÖ `app/core/normalize.py::run()`

### 4. –¢–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- ‚úÖ `app/core/tags.py::tag_text()`
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π

### 5. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
- ‚úÖ `app/bot/handlers_admin.py::metrics_handler()` - –Ω–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ `/metrics`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å–ø—Ä–∞–≤–∫–∞ `/admin_help`

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:
- ‚úÖ **30 —Ç–µ—Å—Ç–æ–≤** –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –º–µ—Ç—Ä–∏–∫
- ‚úÖ **Thread-safety** —Ç–µ—Å—Ç—ã
- ‚úÖ **Integration** —Ç–µ—Å—Ç—ã —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –º–æ–¥—É–ª—è–º–∏
- ‚úÖ **Performance** —Ç–µ—Å—Ç—ã –¥–ª—è –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª–µ–π –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- ‚úÖ **Error handling** —Ç–µ—Å—Ç—ã

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
```python
# –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
test_inc_counter()
test_error_tracking()
test_latency_observation()

# –¢–∞–π–º–µ—Ä—ã –∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã
test_timer_context_manager()
test_async_timer()
test_wrap_timer_sync_function()

# –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
test_get_error_rate()
test_percentile_calculations()
test_concurrent_operations()

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
test_full_pipeline_simulation()
test_llm_retry_scenario()
test_notion_batch_processing()
```

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:
- ‚ùå –ù–µ—Ç –≤–∏–¥–∏–º–æ—Å—Ç–∏ –≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚ùå –°–ª–æ–∂–Ω–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
- ‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å usage LLM —Ç–æ–∫–µ–Ω–æ–≤

### –ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:
- ‚úÖ **–ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ **–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** –ø—Ä–æ–±–ª–µ–º —á–µ—Ä–µ–∑ `/metrics`
- ‚úÖ **–î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** (—É–∑–∫–∏–µ –º–µ—Å—Ç–∞, —Ç–æ–∫–µ–Ω—ã, cache hit rate)
- ‚úÖ **Production-ready –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** 
- ‚úÖ **700/700 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏**
- ‚úÖ **75% –ø–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞**
- ‚úÖ **Thread-safe –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**

### –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª—å–Ω–æ–π –ø–æ–ª—å–∑—ã:

#### üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:
```
–ü—Ä–æ–±–ª–µ–º–∞: "–ë–æ—Ç –º–µ–¥–ª–µ–Ω–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–∞–π–ª—ã"
/metrics ‚Üí llm.extract_commits: p95=5678ms (–Ω–æ—Ä–º–∞: ~2000ms)
–†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–±–ª–µ–º–∞ –≤ OpenAI API, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å retry logic
```

#### üìä –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:
```
–ê–Ω–∞–ª–∏–∑: /metrics ‚Üí llm.summarize: 234,567 —Ç–æ–∫–µ–Ω–æ–≤ –∑–∞ –¥–µ–Ω—å
–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –°–æ–∫—Ä–∞—Ç–∏–ª–∏ –ø—Ä–æ–º–ø—Ç –Ω–∞ 20% ‚Üí —ç–∫–æ–Ω–æ–º–∏—è $15/–¥–µ–Ω—å
```

#### üéØ SLA –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
```
–¶–µ–ª—å: 95% —Ñ–∞–π–ª–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∑–∞ ‚â§2 –º–∏–Ω—É—Ç—ã
/metrics ‚Üí pipeline.total: p95=1847ms ‚úÖ SLA –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
```

## üîÆ –ë—É–¥—É—â–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫:
- **Prometheus** endpoint –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **Grafana** –¥–∞—à–±–æ—Ä–¥—ã –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
- **Notion** –¥–∞—à–±–æ—Ä–¥ –¥–ª—è –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫

### –ê–≤—Ç–æ–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:
- **Smart retry** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏
- **Load balancing** - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- **Adaptive batching** - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–µ–π

### –ê–ª–µ—Ä—Ç—ã:
- **Error rate** > 5% ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞
- **Latency p95** > 3000ms ‚Üí –∞–ª–µ—Ä—Ç –æ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏
- **Token usage** > –ª–∏–º–∏—Ç ‚Üí –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –±—é–¥–∂–µ—Ç–∞

---

**–°–∏—Å—Ç–µ–º–∞ –º–µ—Ç—Ä–∏–∫ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç Meet-Commit Bot –∏–∑ "—á–µ—Ä–Ω–æ–≥–æ —è—â–∏–∫–∞" –≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–∑—Ä–∞—á–Ω—É—é, –º–æ–Ω–∏—Ç–æ—Ä–∏–º—É—é –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º—É—é —Å–∏—Å—Ç–µ–º—É —É—Ä–æ–≤–Ω—è production.**
