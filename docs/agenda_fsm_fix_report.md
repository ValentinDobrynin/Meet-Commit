# üîß –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï FSM –ü–†–û–ë–õ–ï–ú–´ –í AGENDA –°–ò–°–¢–ï–ú–ï

## üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã `/agenda` ‚Üí –≤—ã–±–æ—Ä "—Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–≤–µ—Å—Ç–∫–∏ –ø–æ –ª—é–¥—è–º" ‚Üí –≤–≤–æ–¥ –∏–º–µ–Ω–∏ —á–µ–ª–æ–≤–µ–∫–∞ –ø—Ä—è–º—ã–º —Ç–µ–∫—Å—Ç–æ–º (–Ω–µ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏), –±–æ—Ç –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–µ–∫—Å—Ç –∫–∞–∫ –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—é.

**–ü—Ä–∏—á–∏–Ω–∞:** –í –æ—Å–Ω–æ–≤–Ω–æ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ —Ç–µ–∫—Å—Ç–∞ `receive_input()` –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π FSM –¥–ª—è agenda —Å–∏—Å—Ç–µ–º—ã.

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ—à–∏–±–∫–∏:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `/agenda`
2. –ë–æ—Ç: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é —Ç–∏–ø–æ–≤ –ø–æ–≤–µ—Å—Ç–æ–∫
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –≤—ã–±–∏—Ä–∞–µ—Ç "–ø–æ –ª—é–¥—è–º" 
4. –ë–æ—Ç: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ `AgendaStates.waiting_person_name`
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –≤–≤–æ–¥–∏—Ç "Valya Dobrynin" (—Ç–µ–∫—Å—Ç–æ–º)
6. **–ü–†–û–ë–õ–ï–ú–ê:** `receive_input()` –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç agenda —Å–æ—Å—Ç–æ—è–Ω–∏—è
7. –ë–æ—Ç: –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–∞–∫ —Ç–µ–∫—Å—Ç –¥–ª—è —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏ ‚ùå

### **–ö–æ–¥ –ø—Ä–æ–±–ª–µ–º—ã –≤ `app/bot/handlers.py`:**
```python
@router.message(F.document | (F.text & ~F.text.startswith("/")))
async def receive_input(msg: Message, state: FSMContext):
    current_state = await state.get_state()
    
    # ‚úÖ –ï—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è IngestStates.waiting_extra
    # ‚úÖ –ï—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è PeopleStates.waiting_assign_en
    # ‚ùå –ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è AgendaStates!
    
    # –ü–æ—ç—Ç–æ–º—É —Ç–µ–∫—Å—Ç –∏–¥–µ—Ç –Ω–∞ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—é...
```

## ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### **1. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ AgendaStates –≤ `receive_input()`:**
```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –Ω–∞—Ö–æ–¥–∏–º—Å—è –ª–∏ –º—ã –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ Agenda
from app.bot.handlers_agenda import AgendaStates

if current_state == AgendaStates.waiting_person_name:
    # –ï—Å–ª–∏ –¥–∞, —Ç–æ —ç—Ç–æ –≤–≤–æ–¥ –∏–º–µ–Ω–∏ —á–µ–ª–æ–≤–µ–∫–∞ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–≤–µ—Å—Ç–∫–∏
    from app.bot.handlers_agenda import handle_person_name_input
    await handle_person_name_input(msg, state)
    return

if current_state == AgendaStates.waiting_meeting_id:
    # –ï—Å–ª–∏ –¥–∞, —Ç–æ —ç—Ç–æ –≤–≤–æ–¥ ID –≤—Å—Ç—Ä–µ—á–∏ –¥–ª—è –ø–æ–≤–µ—Å—Ç–∫–∏ –ø–æ –≤—Å—Ç—Ä–µ—á–µ
    from app.bot.handlers_agenda import handle_meeting_id_input
    await handle_meeting_id_input(msg, state)
    return

if current_state == AgendaStates.waiting_tag_name:
    # –ï—Å–ª–∏ –¥–∞, —Ç–æ —ç—Ç–æ –≤–≤–æ–¥ —Ç–µ–≥–∞ –¥–ª—è —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–≤–µ—Å—Ç–∫–∏
    from app.bot.handlers_agenda import handle_tag_name_input
    await handle_tag_name_input(msg, state)
    return
```

### **2. –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ FSM —Å–æ—Å—Ç–æ—è–Ω–∏–π:**
```python
current_state = await state.get_state()
logger.debug(f"Current FSM state: {current_state}")
```

### **3. –°–æ–∑–¥–∞–Ω comprehensive —Ç–µ—Å—Ç:**
- ‚úÖ 8 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ FSM
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç –≤—Å–µ –µ—â–µ –∏–¥–µ—Ç –Ω–∞ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—é
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```
‚úÖ 8/8 —Ç–µ—Å—Ç–æ–≤ FSM –ø—Ä–æ—Ö–æ–¥—è—Ç
‚úÖ –í—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è agenda –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚úÖ –û–±—ã—á–Ω–∞—è —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –Ω–µ –Ω–∞—Ä—É—à–µ–Ω–∞
‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–æ–±–∞–≤–ª–µ–Ω–æ
```

### **–û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: `/agenda`
2. –ë–æ—Ç: –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é —Ç–∏–ø–æ–≤ –ø–æ–≤–µ—Å—Ç–æ–∫
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –≤—ã–±–∏—Ä–∞–µ—Ç "–ø–æ –ª—é–¥—è–º"
4. –ë–æ—Ç: —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `AgendaStates.waiting_person_name`
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –≤–≤–æ–¥–∏—Ç "Valya Dobrynin"
6. **‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û:** `receive_input()` —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç agenda —Å–æ—Å—Ç–æ—è–Ω–∏–µ
7. –ë–æ—Ç: –≤—ã–∑—ã–≤–∞–µ—Ç `handle_person_name_input()` ‚úÖ
8. –ë–æ—Ç: –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é –ø–æ–≤–µ—Å—Ç–∫—É ‚úÖ

## üéØ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### **–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ —Ñ–∞–π–ª—ã:**
- ‚úÖ `app/bot/handlers.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ AgendaStates
- ‚úÖ `tests/test_agenda_fsm_fix.py` - comprehensive —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ FSM

### **–ü–æ–∫—Ä—ã—Ç—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM:**
- ‚úÖ `AgendaStates.waiting_person_name` - –≤–≤–æ–¥ –∏–º–µ–Ω–∏ —á–µ–ª–æ–≤–µ–∫–∞
- ‚úÖ `AgendaStates.waiting_meeting_id` - –≤–≤–æ–¥ ID –≤—Å—Ç—Ä–µ—á–∏  
- ‚úÖ `AgendaStates.waiting_tag_name` - –≤–≤–æ–¥ —Ç–µ–≥–∞
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:**
- ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –ø—Ä–µ–∂–¥–µ
- ‚úÖ –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
- ‚úÖ People Miner FSM –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç
- ‚úÖ –í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**üü¢ –ü–†–û–ë–õ–ï–ú–ê FSM –í AGENDA –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–®–ï–ù–ê!**

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ **–¢–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥ –≤ agenda** —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ **FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç—Å—è** –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ **–°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –Ω–µ –Ω–∞—Ä—É—à–µ–Ω–∞** –¥–ª—è –æ–±—ã—á–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
- ‚úÖ **8 –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤** –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ** –¥–ª—è –±—É–¥—É—â–µ–π –æ—Ç–ª–∞–¥–∫–∏

**–¢–µ–ø–µ—Ä—å –∫–æ–º–∞–Ω–¥–∞ `/agenda` —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∫–∞–∫ —Å –∫–Ω–æ–ø–∫–∞–º–∏, —Ç–∞–∫ –∏ —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º –≤–≤–æ–¥–æ–º! üöÄ**

---

*–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è: 29 —Å–µ–Ω—Ç—è–±—Ä—è 2025*  
*–°—Ç–∞—Ç—É—Å: ‚úÖ FSM –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê*  
*–†–µ–∑—É–ª—å—Ç–∞—Ç: üü¢ AGENDA –°–ò–°–¢–ï–ú–ê –ü–û–õ–ù–û–°–¢–¨–Æ –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–ê*

