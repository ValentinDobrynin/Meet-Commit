# Задача
Извлеки из транскрипта встречи все явные обязательства (commitments). Не фантазируй. Работай только с тем, что явно сказано.

# Контекст
- Участники (каноника EN): {ATTENDEES}  
- Дата встречи (ISO): {DATE}

# Вывод
Верни **ТОЛЬКО** валидный UTF-8 JSON, без комментариев и без Markdown-ограждений:
{
  "commits": [
    {
      "text": "string, полная формулировка обязательства",
      "direction": "mine" | "theirs",
      "assignees": ["EN-имя", "..."],   // если уверенно известны; иначе []
      "due_iso": "YYYY-MM-DD" | null,   // только если дата явно присутствует в тексте
      "confidence": 0.0..1.0,
      "flags": ["optional_flag", "..."],
      "context": "краткий исходный фрагмент",
      "reasoning": "почему так классифицировано в 1-2 фразах"
    }
  ]
}

# Правила
1) **Direction**
   - mine — обязательство Валентина (говорю «я сделаю», «подготовлю», «отправлю»; или явно «Валентин сделает»).
   - theirs — обязательство другого участника.
   - Если неоднозначно — выбери наиболее вероятное и **понизь confidence**.

2) **Assignees**
   - Используй **только** имена из списка {ATTENDEES}. Совпадения по речи: «Саша возьмёт», «Даниил отправит».
   - Если имя за пределами {ATTENDEES} или неочевидно — оставь `assignees: []` и добавь флаг `ambiguous_assignee`.

3) **Due**
   - Разрешена **только явная дата** в тексте: «до 15 апреля», «к 2025-09-30», «15.10».
   - Не конвертируй относительные сроки («к пятнице», «через неделю»). В таких случаях `due_iso: null` и флаг `relative_due`.
   - Если указана только день/месяц без года — **не заполняй** due_iso (валидация и нормализация сделают это позже).

4) **Text**
   - Дай самодостаточную формулировку задачи, без лишнего контекста, но так, чтобы её можно было исполнить.

5) **Context**
   - Приведи 1-2 предложения оригинала вокруг места, где найдено обязательство.

6) **Confidence (эвристика)**
   Высокая уверенность (0.8–1.0), если:
   - явный исполнитель и формулировка действия;
   - есть явный срок;
   - первое лицо («я сделаю», «мы договорились, что X сделает»).
   Средняя (0.6–0.79) — всё понятно, но без срока или с одним слабым местом.  
   Низкая (0.4–0.59) — пассив, нет субъекта, много условностей.  
   <0.4 — лучше не включать в список.

7) **Flags** (по ситуации)
   - `ambiguous_assignee` — не ясен исполнитель.
   - `relative_due` — относительный срок без календарной даты.
   - `unclear_deadline` — срок упомянут расплывчато.
   - `passive_voice` — пассивная формулировка.
   - `no_explicit_subject` — нет явного субъекта.
   - `multi_owner` — несколько потенциальных исполнителей.
   Используй только нужные, без выдумки.

8) **Запреты**
   - Не придумывай имена вне {ATTENDEES}.
   - Не придумывай даты. Если нет — `due_iso: null`.
   - Не добавляй поля, которых нет в схеме.

# Подсказки распознавания
- Триггеры действий: «сделаю», «подготовлю», «проверю», «отправлю», «созвонимся», «согласую», «закрою», «перешлю», «соберу», «обновлю».
- Формулы обещаний: «X сделает Y до Z», «возьму на себя», «обязан», «надо сделать» + субъект.

# Примеры (синтетика)

Вход (фрагмент):
«Даня, возьми на себя отчёт по IFRS до 15 апреля. Я подготовлю сводку метрик к следующему четвергу. Если получится — Иван глянет бюджет.»

Выход:
{
  "commits": [
    {
      "text": "Подготовить отчёт по IFRS",
      "direction": "theirs",
      "assignees": ["Daniil"],
      "due_iso": null,
      "confidence": 0.82,
      "flags": ["relative_due"],
      "context": "Даня, возьми на себя отчёт по IFRS до 15 апреля...",
      "reasoning": "Имя Даня соответствует Daniil из списка; явное поручение. Дата без года → не заполняю due_iso."
    },
    {
      "text": "Подготовить сводку метрик",
      "direction": "mine",
      "assignees": ["Valentin"],
      "due_iso": null,
      "confidence": 0.76,
      "flags": ["relative_due"],
      "context": "Я подготовлю сводку метрик к следующему четвергу.",
      "reasoning": "Первое лицо. Срок относительный → без due_iso."
    }
  ]
}

# Финальное требование
Верни только объект JSON вида {"commits":[...]} без дополнительных текстов.
